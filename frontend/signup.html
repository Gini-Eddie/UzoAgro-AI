<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up | UzoAgro AI</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŒ¿</text></svg>">
    <style>
        :root {
            --dark-green: #143621; --lime-green: #D4ED6D; --accent-orange: #C05621;
            --ash-black: #1A202C; --shade-white: #F7FAFC; --pure-white: #FFFFFF;
            --border-color: #E2E8F0; --radius: 12px;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: "Segoe UI", sans-serif; }
        body { background-color: var(--shade-white); color: var(--ash-black); display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 2rem 1rem; }

        .auth-card { background: var(--pure-white); padding: 3rem; border-radius: var(--radius); border: 1px solid var(--border-color); box-shadow: 0 10px 15px rgba(0,0,0,0.05); width: 100%; max-width: 650px; }
        .logo-header { text-align: center; margin-bottom: 2rem; }
        .logo-header a { color: var(--dark-green); font-size: 2rem; display: flex; align-items: center; justify-content: center; gap: 10px; text-decoration: none; font-weight: 700; }

        .role-toggle { display: flex; background: var(--shade-white); border-radius: 50px; padding: 0.5rem; margin-bottom: 2rem; border: 1px solid var(--border-color); }
        .role-btn { flex: 1; padding: 0.85rem; text-align: center; border-radius: 50px; cursor: pointer; font-weight: bold; transition: 0.3s; color: var(--ash-black); font-size: 0.95rem; }
        .role-btn.active { background: var(--dark-green); color: var(--pure-white); }

        .form-group { margin-bottom: 1.25rem; }
        .flex-group { display: flex; gap: 1rem; }
        label { display: block; font-weight: 600; margin-bottom: 0.5rem; font-size: 0.95rem; color: var(--dark-green); }
        input, select { width: 100%; padding: 0.85rem; border: 1px solid var(--border-color); border-radius: 8px; font-size: 1rem; background: var(--shade-white); color: var(--ash-black); }
        input:focus, select:focus { outline: none; border-color: var(--lime-green); }

        .security-badge { font-size: 0.8rem; color: #718096; display: flex; align-items: center; gap: 5px; margin-top: 0.5rem; }
        .btn { width: 100%; background: var(--dark-green); color: white; border: none; padding: 1rem; border-radius: 8px; font-weight: bold; font-size: 1.1rem; cursor: pointer; margin-top: 1rem; transition: 0.3s; }
        .btn:hover { background: var(--lime-green); color: var(--dark-green); }

        .driver-fields { display: none; }

        /* Mobile Fixes */
        @media (max-width: 600px) {
            .auth-card { padding: 2rem 1.5rem; }
            .flex-group { flex-direction: column; gap: 1.25rem; }
            .role-toggle { flex-direction: column; border-radius: 12px; }
            .role-btn { border-radius: 8px; }
        }
    </style>
</head>
<body>

    <div class="auth-card">
        <div class="logo-header">
            <a href="index.html">ðŸŒ¿ UzoAgro AI</a>
            <p style="color: #718096; margin-top: 0.5rem;">Join the intelligent logistics network.</p>
        </div>

        <div class="role-toggle">
            <div class="role-btn active" id="btn-farmer" onclick="toggleRole('farmer')">I am a Farmer</div>
            <div class="role-btn" id="btn-driver" onclick="toggleRole('driver')">I am a Driver</div>
        </div>

        <form id="signupForm">
            <div class="form-group">
                <label>Full Name / Farm Name</label>
                <input type="text" id="regName" placeholder="Enter your full name" required>
            </div>

            <div class="form-group flex-group">
                <div style="flex: 1;">
                    <label>Phone Number</label>
                    <input type="tel" id="regPhone" placeholder="080XXXXXXXX" required>
                </div>
                <div style="flex: 1;">
                    <label>NIN (Security Verification)</label>
                    <input type="text" id="regNin" placeholder="11-digit NIN" required>
                    <span class="security-badge">ðŸ”’ Encrypted securely</span>
                </div>
            </div>

            <div class="farmer-fields">
                <div class="form-group">
                    <label>Primary Farm Location</label>
                    <select id="farmerCity">
                        <option value="" disabled selected>Select your region...</option>
                        <option value="Lagos">Lagos</option><option value="Ibadan">Ibadan</option>
                        <option value="Ilorin">Ilorin</option><option value="Akure">Akure</option>
                        <option value="Abuja">Abuja</option><option value="Kano">Kano</option>
                        <option value="Kaduna">Kaduna</option><option value="Jos">Jos</option>
                        <option value="Sokoto">Sokoto</option><option value="Enugu">Enugu</option>
                        <option value="Awka">Awka</option><option value="Onitsha">Onitsha</option>
                        <option value="Owerri">Owerri</option><option value="Port Harcourt">Port Harcourt</option>
                        <option value="Uyo">Uyo</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Primary Crop Category</label>
                    <select id="farmerCrop">
                        <option>Grains (Rice, Maize, Beans)</option>
                        <option>Tubers (Yam, Cassava)</option>
                        <option>Perishables (Tomatoes, Onions)</option>
                    </select>
                </div>
            </div>

            <div class="driver-fields">
                <div class="form-group flex-group">
                    <div style="flex: 1;">
                        <label>Home Base (Return City)</label>
                        <select id="driverCity">
                            <option value="" disabled selected>Select base...</option>
                            <option value="Lagos">Lagos</option><option value="Kano">Kano</option>
                            <option value="Abuja">Abuja</option><option value="Port Harcourt">Port Harcourt</option>
                            <option value="Enugu">Enugu</option><option value="Ibadan">Ibadan</option>
                        </select>
                    </div>
                    <div style="flex: 1;">
                        <label>Truck Tonnage</label>
                        <select id="driverCapacity">
                            <option>5 Tons</option><option>10 Tons</option><option>15 Tons</option>
                            <option>30 Tons</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Crops Permitted in Truck</label>
                    <input type="text" id="driverAllowedCrops" placeholder="e.g. Maize, Yam, Beans">
                </div>
            </div>

            <button type="button" class="btn" onclick="submitSignup()">Create Secure Account</button>
            <p style="text-align: center; margin-top: 1rem; color: #4A5568; font-size: 0.95rem;">
                Already have an account? <a href="login.html" style="color: var(--dark-green); font-weight: bold; text-decoration: none;">Log in</a>
            </p>
        </form>
    </div>

    <script>
        function toggleRole(role) {
            const btnFarmer = document.getElementById('btn-farmer');
            const btnDriver = document.getElementById('btn-driver');
            const farmerFields = document.querySelector('.farmer-fields');
            const driverFields = document.querySelector('.driver-fields');

            if (role === 'farmer') {
                btnFarmer.classList.add('active'); btnDriver.classList.remove('active');
                farmerFields.style.display = 'block'; driverFields.style.display = 'none';
            } else {
                btnDriver.classList.add('active'); btnFarmer.classList.remove('active');
                driverFields.style.display = 'block'; farmerFields.style.display = 'none';
            }
        }

        async function submitSignup() {
            const btn = document.querySelector('.btn');
            const originalText = btn.textContent;
            btn.textContent = "Processing...";
            btn.disabled = true;

            const isFarmer = document.getElementById('btn-farmer').classList.contains('active');
            const role = isFarmer ? 'farmer' : 'driver';
            const name = document.getElementById('regName').value;
            const phone = document.getElementById('regPhone').value;
            const nin = document.getElementById('regNin').value;
            const primary_city = isFarmer ? document.getElementById('farmerCity').value : document.getElementById('driverCity').value;

            if(!name || !phone || !nin || !primary_city) {
                alert("Please fill out all required fields.");
                btn.textContent = originalText; btn.disabled = false;
                return;
            }

            const payload = { role, name, phone, nin, primary_city };

            try {
                const response = await fetch('https://gini-eddie-uzoagro-api.hf.space/api/signup', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (response.ok) {
                    // CRITICAL UX FIX: Instantly log them in and send them to the dashboard
                    localStorage.setItem('uzoagro_user', JSON.stringify({
                        name: name,
                        role: role,
                        phone: phone
                    }));
                    window.location.href = 'dashboard.html';
                } else {
                    const error = await response.json();
                    alert('Error: ' + error.detail);
                }
            } catch (err) {
                alert('Connection error. Ensure the UzoAgro AI backend is live.');
            } finally {
                btn.textContent = originalText; btn.disabled = false;
            }
        }
    </script>
</body>
</html>